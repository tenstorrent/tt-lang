// SPDX-FileCopyrightText: (c) 2025 Tenstorrent AI ULC
//
// SPDX-License-Identifier: Apache-2.0

//===----------------------------------------------------------------------===//
// TTL Elementwise Operation Definitions
//===----------------------------------------------------------------------===//
//
// This file defines mappings for TTL elementwise operations, supporting:
// 1. TTL tensor ops -> ttl.compute with tile ops (ConvertTTLToCompute)
// 2. TTL tile ops -> TTKernel ops (ConvertTTLTileOpsToTTKernel)
// 3. Python binding generation (gen_elementwise.py)
//
// It uses the X-macro pattern to generate boilerplate code for pattern
// definitions and registration.
//
// Macro signatures:
//   TTL_BINARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
//   TTL_UNARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
//   TTL_BINARY_TILE_OP_MINMAX(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
//
// Parameters:
//   TTL_OP     - TTL tensor op name (e.g., Add -> ttl::AddOp)
//   TILE_OP   - TTL tile op name (e.g., AddTileOp -> ttl::AddTileOp)
//   TTK_INIT  - TTKernel init op (e.g., AddBinaryTilesInitOp)
//   TTK_COMPUTE - TTKernel compute op (e.g., AddBinaryTilesOp)
//
// Usage:
//   #define TTL_BINARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE) ...
//   #define TTL_UNARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE) ...
//   #include "ttlang/Dialect/TTL/TTLElementwiseOps.def"
//
//===----------------------------------------------------------------------===//

//===----------------------------------------------------------------------===//
// Elementwise operation mappings
//===----------------------------------------------------------------------===//

#ifndef TTL_BINARY_TILE_OP
#define TTL_BINARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
#endif

#ifndef TTL_UNARY_TILE_OP
#define TTL_UNARY_TILE_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
#endif

// Macro for binary ops that use 2-arg in-place form (max, min).
// DST[dst0] = op(DST[dst0], DST[dst1])
#ifndef TTL_BINARY_TILE_OP_MINMAX
#define TTL_BINARY_TILE_OP_MINMAX(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
#endif

// CB -> DST unary ops with an attribute (e.g., bcast).
// These read from CB (not DST), write to DST, and have an extra attribute.
#ifndef TTL_CB_UNARY_ATTR_OP
#define TTL_CB_UNARY_ATTR_OP(TTL_OP, TILE_OP, TTK_INIT, TTK_COMPUTE)
#endif

// Binary operations: TTL tensor op -> TTL tile op -> TTKernel init/compute ops
// These use the standard 3-arg binary template: DST[odst] = op(DST[src0], DST[src1])
TTL_BINARY_TILE_OP(Add, AddTileOp, AddBinaryTilesInitOp, AddBinaryTilesOp)
TTL_BINARY_TILE_OP(Sub, SubTileOp, SubBinaryTilesInitOp, SubBinaryTilesOp)
TTL_BINARY_TILE_OP(Mul, MulTileOp, MulBinaryTilesInitOp, MulBinaryTilesOp)
TTL_BINARY_TILE_OP(Div, DivTileOp, DivBinaryTilesInitOp, DivBinaryTilesOp)

// Binary ops with 2-arg in-place form (TTLTileMaxToTTKernel template)
TTL_BINARY_TILE_OP_MINMAX(Max, MaxTileOp, BinaryMaxTileInitOp, BinaryMaxTileOp)
TTL_BINARY_TILE_OP_MINMAX(Min, MinTileOp, BinaryMinTileInitOp, BinaryMinTileOp)

// Unary operations: TTL tensor op -> TTL tile op -> TTKernel init/compute ops
// These use the standard unary template: DST[dst_idx] = op(DST[dst_idx])
TTL_UNARY_TILE_OP(Exp, ExpTileOp, ExpTileInitOp, ExpTileOp)
TTL_UNARY_TILE_OP(Log, LogTileOp, LogTileInitOp, LogTileOp)
TTL_UNARY_TILE_OP(Sqrt, SqrtTileOp, SqrtTileInitOp, SqrtTileOp)
TTL_UNARY_TILE_OP(Rsqrt, RsqrtTileOp, RsqrtTileInitOp, RsqrtTileOp)
TTL_UNARY_TILE_OP(Tanh, TanhTileOp, TanhTileInitOp, TanhTileOp)
TTL_UNARY_TILE_OP(Abs, AbsTileOp, AbsTileInitOp, AbsTileOp)
TTL_UNARY_TILE_OP(Neg, NegTileOp, NegativeTileInitOp, NegativeTileOp)
TTL_UNARY_TILE_OP(Relu, ReluTileOp, ReluTileInitOp, ReluTileOp)
TTL_UNARY_TILE_OP(Sigmoid, SigmoidTileOp, SigmoidTileInitOp, SigmoidTileOp)
TTL_UNARY_TILE_OP(Floor, FloorTileOp, RoundingTileInitOp, FloorTileOp)
TTL_UNARY_TILE_OP(Recip, RecipTileOp, RecipTileInitOp, RecipTileOp)

// CB -> DST ops with attribute
TTL_CB_UNARY_ATTR_OP(Bcast, TileBcastOp, UnaryBcastInitOp, UnaryBcastTileOp)

#undef TTL_BINARY_TILE_OP
#undef TTL_UNARY_TILE_OP
#undef TTL_BINARY_TILE_OP_SPECIAL
#undef TTL_CB_UNARY_ATTR_OP
#undef TTL_BINARY_TILE_OP_MINMAX
