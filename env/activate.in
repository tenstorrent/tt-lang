# SPDX-FileCopyrightText: (c) 2025 Tenstorrent AI ULC
#
# SPDX-License-Identifier: Apache-2.0

# tt-lang environment activation (generated by CMake)
# This script activates the tt-mlir toolchain environment and adds tt-lang specific paths.

# Guard against re-activation.
if [ -n "${TTLANG_ENV_ACTIVATED}" ]; then
  deactivate 2>/dev/null || :
  unset TTLANG_ENV_ACTIVATED
fi

# Set tt-lang home directory.
export TT_LANG_HOME="@TT_LANG_HOME@"

# Set toolchain directory (configured by CMake).
export TTMLIR_TOOLCHAIN_DIR="@TTMLIR_TOOLCHAIN_DIR@"

# Activate the Python virtual environment from the toolchain.
if [ -f "${TTMLIR_TOOLCHAIN_DIR}/venv/bin/activate" ]; then
  . "${TTMLIR_TOOLCHAIN_DIR}/venv/bin/activate"
else
  echo "WARNING: Python virtual environment not found at ${TTMLIR_TOOLCHAIN_DIR}/venv"
  echo "Python packages may not be available."
fi

# Add tt-lang build directories to PATH and PYTHONPATH.
export PATH="@CMAKE_BINARY_DIR@/bin:$PATH"
export PYTHONPATH="@CMAKE_BINARY_DIR@/python_packages:${TT_LANG_HOME}/python:@TTMLIR_PATH@/python_packages:$PYTHONPATH"

# Mark environment as activated.
export TTLANG_ENV_ACTIVATED=1

echo "tt-lang environment activated"
echo "  tt-mlir: @TTMLIR_PATH@"
echo "  Toolchain: ${TTMLIR_TOOLCHAIN_DIR}"
echo "  Python: $(which python3)"
